# 7장_분산 시스템을 위한 유일 ID 생성기 설계

auto_increment 속성이 설정된 관계형 데이터가 분산 환경에 적합하지 않은 이유

- DB 서버 한대로는 그 요구를 감당할 수 없다
- 여러 DB 서버를 쓰는 경우, delay를 낮추기 힘들다

## 유일성이 보장되는 ID를 만드는 방법

### 다중 마스터 복제

- DB의 auto_increment 기능 활용
    - ID의 값을 구할때 1이 아니라, k (db 개수)만큼 증가시킴

단점

- 여러 데이터 센터에 걸쳐 규모를 늘리기 어렵다
- ID가 시간의 흐름에 맞추어 커지도록 보장할 수 없음
- 서버 추가/삭제 할 때 잘 동작하도록 하기 어려움

### UUID

: 컴퓨터 시스템에 저장되는 정보를 유일하게 식별하기 위한 128bit 의 수

장점

- 충돌 가능성이 낮음
- UUID 만드는 것이 단순함
- 동기화 이슈가 없음
- 규모 확장이 쉬움 (각 서버가 알아서 ID를 만들기 때문)

단점

- ID에 숫자 아닌 값이 포함될 수 있음
- ID를 시간 순으로 정렬할 수 없음

### 티켓 서버

- auto_increment 기능을 갖춘 DB서버 (티켓 서버)를 중앙 집중형으로 하나만 사용하는 구조
    - 티켓서버에 웹 서버가 모두 연결되어 있음

장점

- ID에 유일성이 보장됨
- 구현하기 쉬움
- 중소 규모 애플리케이션에 적합

단점

- 티켓서버가 SPOF (single point of failure) 됨
    - 티켓서버에 장애가 발생하면 이 서버를 이용하는 모든 시스템이 영향을 받음
    - 데이터 동기화와 같은 문제 발생할 수 있음

### 트위터 스노플레이크 접근법

divide and conquer

- 생성해야 하는 ID의 구조를 여러 section으로 분할해서 ID를 만드는 방법
- 구성
    - sign bit
    - timestamp
    - 데이터센터 ID : 시스템 시작 시 결정됌
    - 서버 ID : 시스템 시작 시 결정됌
    - 일련 번호
