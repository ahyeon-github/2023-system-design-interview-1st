# 웹 크롤러 설계

웹 크롤러는 검색 엔진에서 널리 쓰는 기술로 웹에 새로 올라오거나 갱신된 콘텐츠를 찾아내는 것이 주목적이다. 웹 크롤러는 몇 개 웹 페이지에서 시작하여 그 링크를 따라 나가면서 새로운 콘테츠를 수집한다.

크롤러의 이용 목적
- 검색 엔진 인덱싱
- 웹 아카이빙
- 웹 마이닝
- 웹 모니터링

웹 크롤러의 복잡도는 설계할 웹 크롤러가 감당해야 하는 데이터의 규모와 기능에 따라서 달라진다.

### 1단계 문제 이해 및 설계 범위 확정
웹 크롤러는 간단하게 url 집합이 입력으로 주어지면 해당 url들이 가리키는 모든 웹 페이지를 다운로드하고 다운받은 웹페이지에서 url들을 추출한다. 추출된 url들을 다운로드할 url 목록에 추가하고 위의 과정을 처음부터 반복한다.

다음은 좋은 웹크롤러가 만족해야할 사항들이다.
- 규모 확장성
- 안정성
- 예절
- 확장성

### 2단계 개략적 설계안 제시 및 동의 구하기
요구사항을 1단계에서 분석한 후 개략적 설계를 진행한다.
설계안을 제시하고 각 컴포넌트의 기능에 대해 알아보자.

#### 시작 URL 집합
웹크롤러가 크롤링을 시작하는 출발점으로 가능한 한 많은 링크를 탐색할 수 있도록 하는 URL을 고르는 것이 바람직하다.

#### 미수집 URL 저장소
다운로드할 URL을 저장 관리하는 컴포넌트로 FIFO 큐를 생각하면 된ㄷ.

#### HTML 다운로더
인터넷에서 웹 페이지를 다운로드하는 컴포넌트다.

#### 도메인 이름 변환기
URL에 대응되는 ip주소를 알려주는 컴포넌트이다.

#### 콘텐츠 파서
독립된 컴포넌트로 웹 페이지를 파싱과 검증 절차를 거치는 컴포넌트

#### 중복 콘텐츠인가?
콘텐츠가 중복되는지 검증하는 효과적인 방법은 웹 페이지의 해시 값을 비교하는 것이다.

#### 콘텐츠 저장소
HTML 문서를 보관하는 시스템으로 저장소를 구현하는 데 쓰일 기술을 고를 때는 저장할 데이터의 유형, 크기, 저장소 접근 빈도, 데이터의 유효 기간 등을 종합적으로 고려해야한다.

#### URL 추출기
HTML 페이즈를 파싱하여 링크들을 골라내는 역할을 하는 컴포넌트

#### URL 필터
문제가 있는 url을 크롤리 대상에서 제외하는 역할을 하는 컴포넌트

#### 이미 방문한 URL?
이미 방문한 url인지 판단할 때는 블룸 필터나 해시 테이블을 이용한다

#### URL 저장소
이미 방문한 URL을 보관하는 저장소

#### 미수집 URL 저장소

#### 예의
서버에 짧은 시간 안에 너무 많은 요청을 보내면 무례한 일이다. 따라서 동일 웹 사이트에 대해서는 한 번에 한 페이지만 요청해야 하고 같은 웹 사이트의 페이지를 다운받는 태스크는 시간차를 두고 실행해야 한다. 이 요구사항을 만족시키기 위해서는 웹사이트 호스트명과 다운로드를 수행하는 작업 쓰레드 사이의 관계를 유지하면 된다.
- 큐 라우터
- 매핑 테이블
- FIFO 큐
  - 전면 큐 : 우선 순위 결정
  - 후면 큐 : 크롤러가 예의 바르게 동작하도록 보증
- 큐 선택기
- 작업 스레드
- 순위 결정장치

이때 웹 페이지의 데이터는 수시로 변경되기 때문에 이미 다운로드한 페이지라도 재수집할 필요가 있다. 이때는 페이지의 변경 이력을 활용하거나 우선순위를 활용하여 중요한 페이지는 더 자주 재수집한다.

#### HTML 다운로더
http 프로토콜을 통해 웹 페이지를 내려 받는 컴포넌트이다. 

* Robots.txt - 웹사이트가 크롤러와 소통하는 표준적 방법으로 이 파일에는 크롤러가 수집해도 되는 페이지 목록이 들어있다.
* 성능 최적화
  * 분산 크롤링
  * 도메인 이름 변환 결과 캐시
  * 지역성
  * 짧은 타임아웃
* 안정성
  * 안정 해시
  * 크롤링 상태 및 수집 데이터 저장
  * 예외 처리
  * 데이터 검증
* 확장성

### 4단계 마무리 
좋은 크롤러가 갖추어야 하는 특성으론 규모 확장성, 예의 ,확정성, 안정성 등이 있다. 웹은 방대하기 때문에 많은 문제점이 있고 뛰어난 웹 크롤러를 설계하는 작업은 단순하지 않다. 다음은 추가로 논의해보면 좋은 사항들이다.
- 서버 측 렌더링
- 원치 않는 페이지 필터링
- 데이터베이스 다중화 및 샤딩
- 수평적 규모 확장성
- 가용성, 일관성, 안정성
- 데이터 분석 솔루션