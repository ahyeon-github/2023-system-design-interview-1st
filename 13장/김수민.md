# 검색어 자동완성 시스템

## 1단계 문제 이해 및 설계 범위 확정

- 사용자가 입력하는 단어의 부분은 첫 부분인지
- 몇 개의 자동 완성 검색어가 표시되어야 하는지
- 자동 완성 검색어 5개를 고르는 기준은
- 맞춤법 검사 기능도 제공해야하는지
- 질의는 영어인지
- 대문자나 특수 문자 처리도 필요한지
- 얼마나 많은 사용자를 지원해야하는지

## 2단계 개략적 설계안 제시 및 동의 구하기

### 데이터 수집 서비스
빈도 테이블에 빈도 수와 단어를 저장한다.

### 질의 서비스
빈도 테이블을 이용해서 사용자가 특정 글자만 완성했을 때 top5 자동완성 검색어가 표시되도록 한다.

## 3단계 상세 설계

### 트라이 자료구조
트라이라는 자료구조를 사용해서 단어의 빈도수에 대해 표현한다. 트라이는 트리 형태의 자료구조로 루트 노드는 빈 문자열을 나타내고 각 노드는 하나의 단어 또는 접두어 문자열로 표현한다.
이렇게 할 경우 ㅅ기간 복잡도는 O(p) + O(c) + O(clogc)이다.(p는 접두어 길이, c는 주어진 노드의 자식 노드 개수)
최악의 경우에는 전체 트라이를 다 검색해야하는 경우도 있는데 이를 해결하기 위한 방법은 두가지가 있다.

#### 접두어 최대 길이 제한
사실상 길게 검색할 일은 없다.
#### 노드에 인기 검색어 캐시
각 노드에 인기 질의어를 캐시한다. 하지만 이 방법은 추가적인 공간이 필요하게 된다는 단점이 있다.

### 데이터 수집 서비스

#### 데이터 분석 서비스 로그
검색창에 입력된 질의에 관한 원본 데이터 보관

#### 로그 취합 서버
이전으로부터 나오는 데이터를 잡 취합하여 시스템에서 사용할 수 있도록 한다. 수집 주기는 적정선으로 결정한다.

#### 작업 서버
주기적으로 비동기적 작업을 실행하는 서버 집합

#### 트라이 캐시
트라이 데이터를 메모리에 유지하여 읽기 연산 성능을 높이는 구실을 하며 매주 트라이 데이터베이스의 스냅샷을 떠서 갱신한다

#### 트라이 데이터베이스
- 문서 저장소 : 몽고디비 같은 문서 저장소를 활용하여 데이터를 편리하게 저장
- 카-값 저장소 : 접두어 데이터를 해시 테이블 키로 변환 각 트라이 노드에 보관된 모든 데이터를 해기 테이블 값으로 변환

#### 질의 서비스
검색 질의가 로드밸런서로 전송 -> 해당 질의를 api 서버로 전송 -> 트라이 캐시에서 데이터를 가져와 해당 요청에 대한 자동완성 검색 제안 응답 -> 트라이 캐시에 없는 경우 데이터를 db에 가져와 캐시에 저장

#### 트라이 연산
트라이 생성, 갱신 등의 과정을 수행하며 트라이 생성은 작업 서버가 담당하고 갱신의 경우 매주 한 번씩 새로운 트라이를 만든 다음에 기존 트라이를 대체하는 방식을 수행한다.

#### 저장소 규모 확장
알파벳 순서에 따른 저장소 서버를 다르게 저장한다. 이때 샤딩을 사용한다

## 4단계 마무리
추가로 논의 사항
- 다국어 지원에 대한 시스템 확장 -> 유니코드
- 국가별로 인기 검색어 순위를 다르게 하는 방법
- 실시간으로 변하는 검색어의 추이를 반영하는 방법