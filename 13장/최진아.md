# 13장_검색어 자동완성 시스템

검색창에 글자를 입력할때마다 클라이언트가 자동완성 백엔드로 요청을 보냄

- ex) dinner 검색 → search?q=d, search?q=di, search?q=din, search?q=dinn, search?q=dinne, search?q=dinner 요청이 차례대로 백엔드에 전송됌

### Trie 자료구조

- 관계형 DB를 사용하면, 데이터가 많아질 경우 DB가 병목이 될 수 있음
- 트라이
    - 문자열들을 간략하게 저장할 수 있는 트리형태의 자료구조
    - 루트 노드 = 빈 문자열
    - 각 노드 = 글자 하나
    - 26개의 노드를 가질 수 있음
1. 해당 접두어(prefix)를 표현하는 노드를 찾음 
2. 해당 노드부터 시작하는 하위 트리를 탐색하여 모든 유효 노드를 찾음
3. 유효 노드들을 정렬하여 가장 사용빈도가 높은 검색어 k개를 찾음 
- 알고리즘 시간 복잡도 제한 방법
    - 접두어 최대 길이 제한
        - p : 접두어의 길이
    - 각 노드에 k개의 인기 검색에 캐시
        - 각 노드에 질의어를 저장할 공간이 많이 필요하게 됌
        - but, 빠른 응답속도가 중요할 경우에는 사용할만함

### 데이터 수집 서비스

1. 데이터 분석 서비스 로그
    - 검색창에 입력된 질의 원본 데이터가 보관됨
    - {query, time}
2. 로그 취합 서버
    - 트위터 → 취합 주기를 짧게
    - 대부분  → 취합 주기 : 일주일
3. 취합된 데이터 → 작업 서버
    - 취합된 데이터 : {query, time, frequency}
    - 작업서버 : 주기적으로 비동기적 작업을 실행하는 서버 집합
        - 트라이 자료구조 생성
        - 트라이 DB에 저장
4. 트라이 데이터베이스 (매주 갱신)
    - 지속성 저장소
    - 문서 저장소 or 키-값 저장소 사용
5. 트라이 캐시
    - 분산 시스템
    - 트라이 데이터를 메모리에 유지하여 읽기 연산 성능을 높임
    - 매주 DB의 상태를 스냅샷하여 갱신

### 질의 서비스

- 주어진 질의에 5개의 인기 검색어를 정렬해 내놓는 서비스
- 방식
    - 브라우저 캐싱
        - 대부분의 application → 자동완성 검색어 제안 결과는 짧은 시간 내에 바뀌지 않음
        - 제안된 검색어들을 브라우저 캐시에 넣어둠
    - AJAX 요청
    - 데이터 샘플링

### 트라이 연산

- 트라이 생성
- 트라이 갱신
- 검색어 삭제
