### 2장 개략적인 규모 추정

" 보편적으로 통용되는 성능 수치상에서 사고 실험을 행하여 추정치를 계산하는 행위로서, 어떤 설계가 요구사항에 부합할 것인지 보기 위한 것 "

개략적인 규모 추정을 효과적으로 해내려면 **2의 제곱수, 응답지연 값, 가용성에 관계된 수치들**을 기본적으로 잘 이해하고 있어야 한다.

### 2의 제곱수

분산 시스템에서 다루는 데이터 양은 엄청나게 커질 수 있으나 그 계산법은 기본을 크게 벗어나지 않는다.

제대로 된 계산 결과를 얻기 위해서는 데이터 불륨의 단위를 2의 제곱수로 표현하면 어떻게 되는지 우선 알아야한다.

### 모든 프로그래머가 알아야 하는 응답지연 값

구글의 제프 딘이 2010년에 통상적은 컴퓨터에서 구현된 연산들의 응답지연 값을 공개한 바가 있다.

해당 수치들은 컴퓨터 연산들의 처리 속도가 어느 정도인지 짐작할 수 있도록 해준다.

이러한 수치가 2020년에 시각화되었는데, 해당 수치들을 분석하면 아래 결과가 나온다.

- 메모리는 빠르지만 디스크는 아직 느리다.
- 디스크 탐색은 가능한 한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지역에 분산되어 있고, 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

### 가용성에 관계된 수치들

고가용성은 시스템이 오랜 시간 동안 지속적으로 중단 없이 운영될 수 있는 능력을 지칭

- 100% : 시스템이 단 한 번도 중단된 적이 없었음을 의미한다.
- 대부분의 서비스는 99% ~ 100% 사이의 값을 갖는다.
- 아마존, 구글 그리고 마이크로소프트 같은 사업자는 99% 이상의 가용률을 보여준다.

### 예제: 트위터 QPS와 저장소 요구량 추정

### 가정

- 월간 능동 사용자는 3억 명이다.
- 50%의 사용자가 트위터를 매일 사용한다.
- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다.
- 미디어를 포함하는 트윗은 10% 정도다.
- 데이터는 5년간 보관한다.

### 추정

QPS(Query Per Second) 추정치 : 초당 처리할 수 있는 쿼리 수

- 월간 능동 사용자는 3억 명이다
- 50%의 사용자가 트위터를 매일 사용한다
- 일간 능동 사용자 = 3억 x 50% = 1.5억

---

- 평균적으로 각 사용자는 매일 2건의 트윗을 올린다
- QPS = 1.5억 x 2 트윗 / 24시간 / 3600초 = 약 3500개
- 최대 QPS = 2 x QPS = 약 7000개

---

미디어 저장을 위한 저장소 요구량

- 평균 트윗 크기
    - tweet_id에 64바이트
    - 텍스트에 140바이트
    - 미디어에 1MB
- 미디어를 포함하는 트윗은 10% 정도다
- 미디어 저장소 요구량 : 1.5억 x 2 x 10 % x 1MB = 30TB/ 일
- 5년간 미디어를 보관하기 위한 저장소 요구량: 30TB x 365 x 5 = 약 55PB

### 팁

개략적인 규모 추정과 관련된 면접에서 가장 중요한 것은 문제를 풀어나가는 절차다. 즉, 올바른 절차를 밟느냐가 결과를 내는 것보다 중요하다. 면접자가 보고 싶어하는 것은 `문제 해결 능력`이다

- 근사치를 활용한 계산 : 99987 / 9.1 보다는 100,000 / 10로 오차 수준을 생각해서 근사치로 계산시간을 줄인다
- 가정들 적어놓기
- 단위를 붙이는 습관 : 5 →  5KB인지 5MB인지 적는 습관
- 계략적 규모 추정 문제 : QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 방법 미리 연습해두기.

### 3장 시스템 설계 면접 공략법

시스템 설계 면접

- 설계 능력의 기술적 측면
- 지원자가 협렵에 적합한 사람인지
- 압박이 심한 상황도 잘 헤쳐나가는지
- 좋은 질문을 던질 능력이 있는지
- 모호한 문제를 건설적으로 해결할 능력이 있는지

부정적인 것

- 설계의 순수성에 집착한 나머지 트레이드 오프를 도외시하고 오버 엔지니어링을 하는지
- 완고함
- 편협함

### 효과적 면접을 위한 4단계 접근법

### 1단계: 문제 이해 및 설계 범위 확정

- 바로 답부터 들이밀지 말자. 속도를 늦추자. 깊이 생각하고 질문하여 요구사항과 가정들을 분명히 하자.
- 생각해볼 수 있는 질문들
    - 구체적으로 어떤 기능들을 만들어야 하나?
    - 제품 사용자 수는 얼마나 되나?
    - 회사의 규모는 얼마나 빨리 커지리라 예상하나?
        - 석 달 뒤의 규모는?
        - 여섯 달 뒤의 규모는?
        - 일년 뒤의 규모는?
    - 회사가 주로 사용하는 기술스택은 무엇인가?
    - 설계를 단순화하기 위해 활용할 수 있는 기존 서비스는 무엇이 있는가?

### 예제 :  뉴스피드 시스템 설계

- 질문
    - 웹, 앱 중 어느 쪽을 지원해야 하는가?
    - 가장 중요한 기능이 무엇인가?
    - 뉴스피드의 정렬상태는 어떻게 되야하는가?
    - 최대 사용자? 친구상태?
    - 트래픽 규모?
    - 피드에 이미지 또는 영상의 유무?
    

### 2단계: 개략적인 설계안 제시 및 동의 구하기

- 개략적인 설계안을 제시하고, 면접관의 동의를 얻는 것
- 설계안에 대한 최초 청사진을 제시하고 의견 구하기 -> 최초 설계안이 시스템 규모에 관계된 제약사항들을 만족하는지 개략적으로 계산해보자.
- 화이트보드나 종이에 핵심 컴포넌트를 포함하는 다이어그램을 그려라
    - 클라이언트(모바일/웹)
    - API
    - 웹 서버
    - 데이터 저장소
    - 캐시
    - CDN
    - 메세지 큐
- Ex) 뉴스 피드 시스템의 경우, 중요한 2가지 기능(피드발행, 피드생성)으로 나눠 설계해볼 수 있다.

### 3단계: 상세 설계

- 대부분의 경우, 면접관은 여러분의 특정 시스템 컴포넌트들의 세부사항을 깊이 있게 설명하는 것을 보길 원한다.
    - Ex)
        - 설계 대상 컴포넌트 사이의 우선순위 정하기!!
            - ex. 단축 URL 생성기
                - 해시 함수 설계를 어떻게 하였는가? → 해시 함수의 설계를 구체적으로 설명하기
            - ex. 채팅 시스템
                - 어떻게 지연시간을 줄였는가?
                - 사용자의 온/오프라인 상태를 표시할 것인가?
        - 불필요한 세부사항에 시간을 쓰지말라
            - ex. 뉴스 피드의 순위를 매기는 데 사용되는 EdgeRank 알고리즘 설명

### 4단계: 마무리

- 시스템에 개선할 점은 언제나 있기 마련이다. 면접관이 개선 가능한 점(병목구간)을 찾으라고 하면 비판적으로 설계를 바라보자.
- 만든 설계를 한번 다시 요약해주자.
- 오류(ex. 서버오류/네트워크 장애 등)가 발생하면 무슨 일이 생기는지 생각해보자.
- 운영 이슈도 논의할 가치가 있다.
    - 메트릭 수집
    - 모니터링
    - 로그
    - 시스템 배포 방법
- 미래에 닥칠 규모 확장 요구에 어떻게 대처할 것인지 생각해보자.

### 하지 말아야 하는 것

- 전형적인 면접 문제들에도 대비하지 않고 면접장에 가지말자.
- 요구사항/가정이 분명하지 않은 상태에서 설계를 하지말자.
- 특정 컴포넌트의 세부사항을 너무 깊게 설명하지 말자. 처음부터 세부사항까지 깊이 설명하지 말라. 개략적 설계부터!
- 진행 중에 막혔다면 힌트 주기를 주저하지 말라
- 소통을 주저하지 말라. 침묵 속에 설계를 진행하지 말라
- 설계안을 내놓는 순간 면접이 끝난다고 생각하지 말라. 면접관이 끝났다고 말하기 전까지는 끝난 것이 아니다. 의견을 일찍, 그리고 자주 구하라****
